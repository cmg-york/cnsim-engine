<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractNetwork.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CNSim Engine</a> &gt; <a href="index.source.html" class="el_package">ca.yorku.cmg.cnsim.engine.network</a> &gt; <span class="el_source">AbstractNetwork.java</span></div><h1>AbstractNetwork.java</h1><pre class="source lang-java linenums">package ca.yorku.cmg.cnsim.engine.network;

import ca.yorku.cmg.cnsim.engine.Simulation;
import ca.yorku.cmg.cnsim.engine.config.Config;
import ca.yorku.cmg.cnsim.engine.node.NodeSet;
import ca.yorku.cmg.cnsim.engine.reporter.Reporter;

/**
 * Represents a generic network structure in a simulation.
 * &lt;p&gt;
 * This class maintains a reference to a {@link NodeSet} object representing the participating nodes
 * and stores point-to-point throughput values between nodes in a 2D {@code float} array {@code Net}.
 * Transmission times can be computed for messages of a given size. See
 * &lt;a href=&quot;../documentation/units.html&quot;&gt;documentation/units&lt;/a&gt; for the units of measurement of throughput and transmission times.
 * &lt;/p&gt;
 * 
 * @author Sotirios Liaskos
 * @version 1.0
 */
public abstract class AbstractNetwork {
	
    /** The set of nodes in the network */
	protected NodeSet ns;

    /** The network throughput matrix in bits per second (bps) */
	public float[][] Net;

	
	// -----------------------------------------------------------------
	// CONSTRUCTORS
	// -----------------------------------------------------------------

	
    /**
     * Empty constructor for testing purposes.
     * Initializes an empty network object.
     */
<span class="fc" id="L38">	public AbstractNetwork() {</span>
<span class="fc" id="L39">	}</span>
	
    /**
     * Constructs a network using the specified {@link NodeSet}.
     * Initializes the throughput matrix with dimensions based on {@code sim.maxNodes}.
     * 
     * @param ns the NodeSet representing the nodes of the network
     * @throws Exception if the number of nodes exceeds the maximum allowed in configuration
     */
<span class="nc" id="L48">	public AbstractNetwork(NodeSet ns) throws Exception {</span>
<span class="nc" id="L49">        int maxNodes = Config.getPropertyInt(&quot;sim.maxNodes&quot;);</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">		if (maxNodes &lt; ns.getNodeSetCount()) {</span>
<span class="nc" id="L51">			throw new Exception(&quot;Node count exceed maximum allowed number of nodes.&quot;);</span>
		}
<span class="nc" id="L53">		Net = new float [maxNodes + 1][maxNodes + 1];</span>
<span class="nc" id="L54">        this.ns = ns;</span>
<span class="nc" id="L55">	}</span>
	

	// -----------------------------------------------------------------
	// TRANSMISSION TIME CALCULATIONS
	// -----------------------------------------------------------------

	
   /**
    * Calculates the transmission time of a message of given size between two nodes.
    * 
    * @param origin      the ID of the origin node
    * @param destination the ID of the destination node
    * @param size        the size of the message in bytes
    * @return the transmission time in &lt;b&gt;milliseconds&lt;/b&gt;, or -1 if the nodes are not connected
    * @throws ArithmeticException if {@code size &lt; 0}
    * @see #getTransmissionTime(float, float)
    * @see &lt;a href=&quot;../documentation/units.html&quot;&gt;documentation/units&lt;/a&gt;
    */
	public long getTransmissionTime(int origin, int destination, float size) {
<span class="nc bnc" id="L75" title="All 2 branches missed.">		if(size &lt; 0)</span>
<span class="nc" id="L76">			throw new ArithmeticException(&quot;Size &lt; 0&quot;);</span>
<span class="nc" id="L77">		float bps = getThroughput(origin, destination);</span>
<span class="nc" id="L78">		return (getTransmissionTime(bps, size));</span>
	}

	
    /**
     * Calculates the transmission time for a message of a given size over a channel with specified throughput.
     * 
     * @param throughput the channel throughput in bits per second (bps)
     * @param size       the size of the message in bytes
     * @return the transmission time in &lt;b&gt;milliseconds&lt;/b&gt;, or -1 if throughput is 0
     * @throws ArithmeticException if {@code size &lt; 0} or {@code throughput &lt; 0}
     * @see &lt;a href=&quot;../documentation/units.html&quot;&gt;documentation/units&lt;/a&gt;
     */
	public long getTransmissionTime(float throughput, float size) {
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">		if(size &lt; 0)</span>
<span class="nc" id="L93">			throw new ArithmeticException(&quot;Size &lt; 0&quot;);</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">		if(throughput &lt; 0)</span>
<span class="nc" id="L95">			throw new ArithmeticException(&quot;Throughput &lt; 0&quot;);</span>

<span class="pc bpc" id="L97" title="1 of 2 branches missed.">	    if(throughput == 0)</span>
<span class="nc" id="L98">	        return (-1);</span>
	    else
		    /* Multiply by 8 because Size is in terms of bytes but throughput is in terms of bits. Multiply by 1000 because throughput is measured in bits/second but expected output is in terms of milliseconds. */
<span class="fc" id="L101">	    	return(Math.round((size * 8 * 1000)/throughput));</span>
	}
	
	
	
	
	// -----------------------------------------------------------------
	// GETTERS AND SETTERS
	// -----------------------------------------------------------------

	
    /**
     * Returns the throughput between two nodes.
     * 
     * @param origin      the ID of the origin node
     * @param destination the ID of the destination node
     * @return the throughput in bits per second (bps)
     * @throws ArithmeticException if {@code origin &lt; 0} or {@code destination &lt; 0}
     */
	public float getThroughput(int origin, int destination) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if(origin &lt; 0)</span>
<span class="nc" id="L122">			throw new ArithmeticException(&quot;Origin &lt; 0&quot;);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">		if(destination &lt; 0)</span>
<span class="nc" id="L124">			throw new ArithmeticException(&quot;Destination &lt; 0&quot;);</span>
<span class="nc" id="L125">		return Net[origin][destination];</span>
	}

    /**
     * Sets the throughput between two nodes.
     * Records the event in the reporter.
     * 
     * @param origin      the ID of the origin node
     * @param destination the ID of the destination node
     * @param throughput  the throughput in bits per second (bps)
     * @throws ArithmeticException if {@code origin &lt; 0}, {@code destination &lt; 0}, or {@code throughput &lt; 0}
     */
	public void setThroughput(int origin, int destination, float throughput) {
<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (Reporter.reportsNetEvents()) {</span>
<span class="nc" id="L139">			Reporter.addNetEvent(Simulation.currentSimulationID, origin, destination, throughput, Simulation.currTime);</span>
		}
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if(origin &lt; 0)</span>
<span class="nc" id="L142">			throw new ArithmeticException(&quot;Origin &lt; 0&quot;);</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		if(destination &lt; 0)</span>
<span class="nc" id="L144">			throw new ArithmeticException(&quot;Destination &lt; 0&quot;);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if(throughput &lt; 0)</span>
<span class="nc" id="L146">			throw new ArithmeticException(&quot;Throughput &lt; 0&quot;);</span>
<span class="nc" id="L147">		Net[origin][destination] = throughput;</span>
<span class="nc" id="L148">	}</span>

	
    /**
     * Calculates the average throughput for a given origin node with all other nodes in the network.
     * 
     * @param origin the ID of the origin node
     * @return the average throughput for the origin node in bits per second (bps)
     */
	public float getAvgTroughput(int origin) {
<span class="nc" id="L158">		float sum=0;</span>
<span class="nc" id="L159">		int i=1, count = 0;</span>
		
<span class="nc bnc" id="L161" title="All 2 branches missed.">		for (i=1; i &lt;= Config.getPropertyInt(&quot;net.numOfNodes&quot;); i++) {</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">	        if(i!=origin)</span>
	        {
<span class="nc" id="L164">	            sum += (Net[origin][i] + Net[i][origin]);</span>
<span class="nc" id="L165">	            count += 2;</span>
	        }
	    }
<span class="nc" id="L168">	    return (sum/count);</span>
	}
	
	
    /**
     * Returns the {@link NodeSet} used to construct this network.
     * 
     * @return the NodeSet representing the nodes in this network
     */
	public NodeSet getNodeSet() {
<span class="fc" id="L178">		return ns;</span>
	}


	/**
     * Prints the network throughput matrix to standard output.
     * Each element represents the throughput between two nodes.
     */
	public void printNetwork() {
<span class="nc bnc" id="L187" title="All 2 branches missed.">		for (float[] x : Net) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">		   for (float y : x) {</span>
<span class="nc" id="L189">		        System.out.printf(&quot;%3.1f &quot;, y);</span>
		   }
<span class="nc" id="L191">		   System.out.println();</span>
		}
<span class="nc" id="L193">	}</span>
	
	
    /**
     * Alternate implementation of network printing.
     * Prints the throughput matrix as plain numbers separated by spaces.
     */
	public void printNetwork2() {
<span class="nc bnc" id="L201" title="All 2 branches missed.">		for (int i = 0; i &lt; Net.length; i++) {</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">			for (int j = 0; j &lt; Net[i].length; j++) {</span>
<span class="nc" id="L203">				System.out.print(Net[i][j] + &quot; &quot;);</span>
			}
<span class="nc" id="L205">			System.out.println();</span>
		}
<span class="nc" id="L207">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>