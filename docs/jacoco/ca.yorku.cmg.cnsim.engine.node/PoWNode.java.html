<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PoWNode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CNSim Engine</a> &gt; <a href="index.source.html" class="el_package">ca.yorku.cmg.cnsim.engine.node</a> &gt; <span class="el_source">PoWNode.java</span></div><h1>PoWNode.java</h1><pre class="source lang-java linenums">package ca.yorku.cmg.cnsim.engine.node;

import ca.yorku.cmg.cnsim.engine.Simulation;
import ca.yorku.cmg.cnsim.engine.event.Event;
import ca.yorku.cmg.cnsim.engine.event.Event_ContainerValidation;
import ca.yorku.cmg.cnsim.engine.transaction.ITxContainer;
import ca.yorku.cmg.cnsim.engine.transaction.Transaction;

/**
 * Abstract class representing a node in a blockchain network.
 * 
 * @author Sotirios Liaskos for the Conceptual Modeling Group @ York University
 * 
 */
public abstract class PoWNode extends Node implements IMiner {

	private float hashPower;
	private float electricPower;
	private float electricityCost;
<span class="fc" id="L20">	private double totalCycles = 0;</span>
<span class="fc" id="L21">	private double prospectiveMiningCycles = 0;</span>
<span class="fc" id="L22">	private boolean isMining = false;</span>
	

	
	// -----------------------------------------------------------------
	// CONSTRUCTOR
	// -----------------------------------------------------------------

	public PoWNode(Simulation sim) {
<span class="fc" id="L31">		super(sim);</span>
<span class="fc" id="L32">	}</span>

	
	

	// -----------------------------------------------------------------
	// A C T I O N S
	// -----------------------------------------------------------------

	
	
	// -----------------------------------------------------------------
	// MINING MANAGEMENT
	// -----------------------------------------------------------------
		
	/**
	 * Starts mining with the specified expected mining interval. 
	 * The interval may be based on when the next validation event takes place.  
	 * @param interval The mining interval (in seconds).
	 */
	public void startMining(double interval) {
<span class="nc" id="L53">		setProspectiveMiningCycles(interval*this.getHashPower());</span>
<span class="nc" id="L54">		isMining = true;</span>
<span class="nc" id="L55">	}</span>

	/**
	 * Starts mining without specifying an expected mining interval.
	 */
	public void startMining() {
<span class="nc" id="L61">		isMining = true;</span>
<span class="nc" id="L62">	}</span>
	
	
	/**
	 * Checks if the node is currently mining.
	 * @return true if the node is mining, false otherwise.
	 */
	public boolean isMining() {
<span class="nc" id="L70">	    return isMining;</span>
	}


	/**
	 * Stops mining
	 */
	public void stopMining() {
<span class="nc" id="L78">		isMining = false;</span>
<span class="nc" id="L79">	}</span>


	// -----------------------------------------------------------------
	// CYCLE COUNTING AND COST CALCULATIONS
	// -----------------------------------------------------------------
	
	/**
	 * Adds the specified number of cycles to the total cycles of the node.
	 * @param c The number of cycles to be added. 
	 */
	public void addCycles(double c) {
<span class="nc" id="L91">		totalCycles += c;</span>
<span class="nc" id="L92">	}</span>
	
	/**
	 * @return the prospectiveMiningCycles
	 */
	public double getProspectiveMiningCycles() {
<span class="nc" id="L98">		return prospectiveMiningCycles;</span>
	}




	/**
	 * @param prospectiveMiningCycles the prospectiveMiningCycles to set
	 */
	public void setProspectiveMiningCycles(double prospectiveMiningCycles) {
<span class="nc" id="L108">		this.prospectiveMiningCycles = prospectiveMiningCycles;</span>
<span class="nc" id="L109">	}</span>




	/**
	 * {@inheritDoc}
	 */
	@Override
	public double getTotalCycles() {
<span class="nc" id="L119">		return totalCycles;</span>
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public double getCostPerGH() {
		//[ [electrictiyCost ($/kWh) * electricPower (W) / 1000 (W/kW)] /  [3600 (s/h) * hashPower (GH/s)]]
<span class="nc" id="L128">		return ( (electricityCost * electricPower / 1000) / (3600 * hashPower) );</span>
	}


	
	// -----------------------------------------------------------------
	// GETTERS AND SETTERS
	// -----------------------------------------------------------------

	//
	// SIMPLE SET/GET
	//
	/**
	 * {@inheritDoc}
	 */
	@Override
	public void setHashPower(float hashpower) {
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">		if(hashpower &lt; 0 )</span>
<span class="nc" id="L146">			throw new ArithmeticException(&quot;Hash Power &lt; 0&quot;);</span>
<span class="fc" id="L147">	    this.hashPower = hashpower;</span>
<span class="fc" id="L148">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public float getHashPower() {
<span class="fc" id="L155">	    return hashPower;</span>
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public void setElectricityCost(float electricityCost) {
<span class="nc bnc" id="L163" title="All 2 branches missed.">		if(electricityCost &lt; 0 )</span>
<span class="nc" id="L164">			throw new ArithmeticException(&quot;Electricity Cost &lt; 0&quot;);</span>
<span class="nc" id="L165">	    this.electricityCost = electricityCost;</span>
<span class="nc" id="L166">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public float getElectricityCost() {
<span class="nc" id="L173">	    return electricityCost;</span>
	}


	/**
	 * {@inheritDoc}
	 */
	@Override
	public float getElectricPower() {
<span class="nc" id="L182">		return this.electricPower;</span>
	}

	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public void setElectricPower(float power) {
<span class="nc" id="L191">		this.electricPower = power;</span>
		
<span class="nc" id="L193">	}</span>
	
	

	
	
	// -----------------------------------------------------------------
	// VALIDATION EVENT CREATION AND MANAGEMENT
	// -----------------------------------------------------------------
	
	
    /**
     * Returns the next validation event associated with this node. Useful for removing the event when necessary.
     * @return The next validation Event.
     */
    public Event getNextValidationEvent() {
<span class="nc" id="L209">    	return this.nextValidationEvent;</span>
    }
    
    /**
     * Deletes the next validation event associated with this node.
     * TODO: how does this affect cycle counting statistics?
     */
    public void resetNextValidationEvent() {
<span class="nc" id="L217">    	this.nextValidationEvent = null;</span>
<span class="nc" id="L218">    }</span>
	
	/**
	 * Schedules a validation event for the specified transaction container at the given time.
	 * @param txc The transaction container to be validated.
	 * @param time The simulation time when the scheduling occurs. The even will be scheduled at `time + mining interval`. 
	 * @return The scheduled mining interval in seconds.
	 */
	public long scheduleValidationEvent(ITxContainer txc, long time) {
<span class="nc" id="L227">		long h = sim.getSampler().getNodeSampler().getNextMiningInterval(getHashPower());</span>
<span class="nc" id="L228">	    Event_ContainerValidation e = new Event_ContainerValidation(txc, this, time + h);</span>
<span class="nc" id="L229">	    this.nextValidationEvent = e;</span>
<span class="nc" id="L230">	    sim.schedule(e);</span>
<span class="nc" id="L231">	    return (h);</span>
	}
    
	
	
	// -----------------------------------------------------------------
	// EVENT HANDLERS / BEHAVIORS
	// -----------------------------------------------------------------
	
	
	
	/**
	 * {@inheritDoc}
	 * TODO: prospectiveMiningCycles must be removed from here, they are inaccurate, in cases of cancellation.
	 */
	@Override
	public void event_NodeCompletesValidation(ITxContainer t, long time) {
<span class="nc" id="L248">		addCycles(getProspectiveMiningCycles());</span>
<span class="nc" id="L249">		setProspectiveMiningCycles(0);</span>
<span class="nc" id="L250">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public void event_NodeReceivesPropagatedTransaction(Transaction t, long time) {
<span class="nc" id="L257">	}</span>


	/**
	 * {@inheritDoc}
	 */
	@Override
	public void event_PrintPeriodicReport(long time) {
<span class="nc" id="L265">		this.periodicReport();</span>
<span class="nc" id="L266">	}</span>



	/**
	 * {@inheritDoc}
	 */
	@Override
	public void event_PrintBeliefReport(long[] sample, long time) {
<span class="nc" id="L275">		this.beliefReport(sample, time);</span>
		
<span class="nc" id="L277">	}</span>

	/**
	 * {@inheritDoc}
	 */
	@Override
	public void event_PrintStructureReport(long time) {
<span class="nc" id="L284">		this.structureReport();</span>
<span class="nc" id="L285">	}</span>


	/**
	 * {@inheritDoc}
	 */
	@Override
	public void event_NodeStatusReport(long time) {
<span class="nc" id="L293">		this.nodeStatusReport();</span>
<span class="nc" id="L294">	}</span>
	
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>